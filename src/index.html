<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DockMon</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <!-- GridStack.js CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gridstack@12.3.3/dist/gridstack.min.css">
    <!-- DockMon CSS -->
    <link rel="stylesheet" href="/css/main.css">
    <!-- Lucide Icons -->
    <script src="/lucide.min.js"></script>
</head>
<body>
    <div class="app-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo-text">DockMon</div>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Main</div>
                    <a class="nav-item active" onclick="switchPage('dashboard')">
                        <span class="nav-icon" data-lucide="layout-dashboard"></span>
                        <span>Dashboard</span>
                    </a>
                    <a class="nav-item" onclick="switchPage('hosts')">
                        <span class="nav-icon" data-lucide="server"></span>
                        <span>Host Management</span>
                    </a>
                    <a class="nav-item" onclick="switchPage('alerts')">
                        <span class="nav-icon" data-lucide="zap"></span>
                        <span>Alert Rules</span>
                    </a>
                    <a class="nav-item" onclick="openNotificationSettings()">
                        <span class="nav-icon" data-lucide="bell"></span>
                        <span>Notification Settings</span>
                    </a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Audit</div>
                    <a class="nav-item" onclick="switchPage('events')">
                        <span class="nav-icon" data-lucide="activity"></span>
                        <span>Events</span>
                    </a>
                    <a class="nav-item" onclick="switchPage('logs')">
                        <span class="nav-icon" data-lucide="file-text"></span>
                        <span>Container Logs</span>
                    </a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">System</div>
                    <a class="nav-item" onclick="openGlobalSettings()">
                        <span class="nav-icon" data-lucide="settings"></span>
                        <span>Settings</span>
                    </a>
                    <a class="nav-item" onclick="switchPage('about')">
                        <span class="nav-icon" data-lucide="info"></span>
                        <span>About</span>
                    </a>
                </div>
            </nav>

            <!-- Logout at bottom of sidebar -->
            <div class="sidebar-footer">
                <a class="nav-item logout-item" onclick="logout()">
                    <span class="nav-icon" data-lucide="log-out"></span>
                    <span>Logout</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <header class="topbar">
                <div class="topbar-left">
                    <button class="menu-toggle" onclick="toggleSidebar()">☰</button>
                    <h1 class="topbar-title" id="pageTitle">Dashboard</h1>
                </div>

                <!-- Blackout Window Indicator (centered) -->
                <div id="quietHoursIndicator" style="display: none; align-items: center; gap: 8px; padding: 8px 16px; background: var(--warning-bg, rgba(255, 193, 7, 0.1)); border: 1px solid var(--warning, #ffc107); border-radius: 6px; color: var(--warning, #ffc107); font-weight: 500; font-size: 14px;">
                    <span data-lucide="moon"></span>
                    <span>In Blackout Window</span>
                </div>

                <div class="topbar-actions">
                    <button class="btn btn-secondary" onclick="openAccountSettings()" title="Account Settings">
                        <span data-lucide="user"></span> <span id="topbarUsername">Account</span>
                    </button>
                    <button class="btn btn-secondary" onclick="refreshAll()">
                        <span data-lucide="refresh-cw"></span> Refresh
                    </button>
                    <button class="btn btn-primary" onclick="openHostModal()">
                        <span data-lucide="plus"></span> Add Host
                    </button>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content">
                <!-- Dashboard Page -->
                <div id="dashboard-page" class="page-section active">

                    <!-- GridStack Container -->
                    <div class="grid-stack" id="dashboard-grid">
                        <!-- Widgets will be dynamically added here -->
                    </div>
                </div>

                <!-- Hosts Management Page -->
                <div id="hosts-page" class="page-section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <span data-lucide="server"></span> Docker Hosts
                            </h2>
                            <button class="btn btn-primary" onclick="openHostModal()">
                                Add New Host
                            </button>
                        </div>
                        <div id="hostsList">
                            <!-- Hosts list will be rendered here -->
                        </div>
                    </div>
                </div>

                <!-- Alert Rules Page -->
                <div id="alerts-page" class="page-section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <span data-lucide="zap"></span> Alert Rules
                            </h2>
                            <button class="btn btn-primary" onclick="openAlertRuleModal()">
                                Create Rule
                            </button>
                        </div>
                        <div id="alertRulesList">
                            <!-- Alert rules will be rendered here -->
                        </div>
                    </div>
                </div>

                <!-- Events Page -->
                <div id="events-page" class="page-section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <span data-lucide="activity"></span> Event Log
                            </h2>
                            <div style="display: flex; gap: var(--spacing-sm);">
                                <button class="btn btn-secondary" onclick="toggleEventSortOrder()" id="sortOrderBtn" title="Toggle sort order">
                                    <span data-lucide="arrow-down-wide-narrow"></span> Newest First
                                </button>
                                <button class="btn btn-secondary" onclick="refreshEvents()">
                                    <span data-lucide="refresh-cw"></span> Refresh
                                </button>
                            </div>
                        </div>

                        <!-- Filters -->
                        <div class="event-filters">
                            <div class="filter-row">
                                <div class="filter-group">
                                    <label>Time Range</label>
                                    <select id="eventTimeRange" onchange="filterEvents()">
                                        <option value="24">Last 24 hours</option>
                                        <option value="12">Last 12 hours</option>
                                        <option value="6">Last 6 hours</option>
                                        <option value="1">Last hour</option>
                                        <option value="all">All time</option>
                                    </select>
                                </div>

                                <div class="filter-group">
                                    <label>Category</label>
                                    <div class="multiselect" id="eventCategoryMultiselect">
                                        <div class="multiselect-trigger" onclick="toggleMultiselect('eventCategory')">
                                            <span class="multiselect-label">All Categories</span>
                                            <span data-lucide="chevron-down"></span>
                                        </div>
                                        <div class="multiselect-dropdown" id="eventCategoryDropdown">
                                            <label><input type="checkbox" value="container" onchange="updateMultiselect('eventCategory')"> Container</label>
                                            <label><input type="checkbox" value="host" onchange="updateMultiselect('eventCategory')"> Host</label>
                                            <label><input type="checkbox" value="alert" onchange="updateMultiselect('eventCategory')"> Alert</label>
                                            <label><input type="checkbox" value="notification" onchange="updateMultiselect('eventCategory')"> Notification</label>
                                            <label><input type="checkbox" value="system" onchange="updateMultiselect('eventCategory')"> System</label>
                                            <label><input type="checkbox" value="user" onchange="updateMultiselect('eventCategory')"> User</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="filter-group">
                                    <label>Severity</label>
                                    <div class="multiselect" id="eventSeverityMultiselect">
                                        <div class="multiselect-trigger" onclick="toggleMultiselect('eventSeverity')">
                                            <span class="multiselect-label">All Severities</span>
                                            <span data-lucide="chevron-down"></span>
                                        </div>
                                        <div class="multiselect-dropdown" id="eventSeverityDropdown">
                                            <label><input type="checkbox" value="critical" onchange="updateMultiselect('eventSeverity')"> Critical</label>
                                            <label><input type="checkbox" value="error" onchange="updateMultiselect('eventSeverity')"> Error</label>
                                            <label><input type="checkbox" value="warning" onchange="updateMultiselect('eventSeverity')"> Warning</label>
                                            <label><input type="checkbox" value="info" onchange="updateMultiselect('eventSeverity')"> Info</label>
                                            <label><input type="checkbox" value="debug" onchange="updateMultiselect('eventSeverity')"> Debug</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="filter-group">
                                    <label>Host</label>
                                    <div class="multiselect" id="eventHostMultiselect">
                                        <div class="multiselect-trigger" onclick="toggleMultiselect('eventHost')">
                                            <span class="multiselect-label">All Hosts</span>
                                            <span data-lucide="chevron-down"></span>
                                        </div>
                                        <div class="multiselect-dropdown" id="eventHostDropdown">
                                            <!-- Dynamically populated -->
                                        </div>
                                    </div>
                                </div>

                                <div class="filter-group filter-search">
                                    <label>Search</label>
                                    <input type="text" id="eventSearch" placeholder="Search events..." onkeyup="debounceEventSearch()">
                                </div>
                            </div>
                        </div>

                        <!-- Events List -->
                        <div id="eventsList" class="events-list">
                            <!-- Events will be rendered here -->
                        </div>

                        <!-- Pagination -->
                        <div id="eventsPagination" class="pagination">
                            <!-- Pagination controls will be rendered here -->
                        </div>
                    </div>
                </div>

                <!-- Container Logs Page -->
                <div id="logs-page" class="page-section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <span data-lucide="file-text"></span> Container Logs
                            </h2>
                            <div style="display: flex; gap: var(--spacing-sm); align-items: center;">
                                <button class="btn btn-secondary" id="logsSortBtn" onclick="toggleLogsSort()" title="Toggle sort order">
                                    <span data-lucide="arrow-down-wide-narrow"></span> Newest First
                                </button>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 0;">
                                    <input type="checkbox" id="logsAutoRefresh" onchange="toggleLogsAutoRefresh()" checked>
                                    <span>Auto-refresh</span>
                                </label>
                                <button class="btn btn-secondary" onclick="clearLogs()">
                                    <span data-lucide="trash-2"></span> Clear
                                </button>
                                <button class="btn btn-secondary" onclick="downloadLogs()">
                                    <span data-lucide="download"></span> Download
                                </button>
                            </div>
                        </div>

                        <!-- Filters and Controls -->
                        <div class="event-filters">
                            <div class="filter-row">
                                <div class="filter-group" style="flex: 2;">
                                    <label>Containers</label>
                                    <div class="multiselect" id="logsContainerMultiselect">
                                        <div class="multiselect-trigger" onclick="toggleMultiselect('logsContainer')">
                                            <span class="multiselect-label">Select containers to view logs...</span>
                                            <span data-lucide="chevron-down"></span>
                                        </div>
                                        <div class="multiselect-dropdown" id="logsContainerDropdown">
                                            <!-- Containers will be populated here -->
                                        </div>
                                    </div>
                                </div>

                                <div class="filter-group">
                                    <label>Lines</label>
                                    <select id="logsTailCount" onchange="reloadLogs()">
                                        <option value="50">50</option>
                                        <option value="100" selected>100</option>
                                        <option value="200">200</option>
                                        <option value="500">500</option>
                                        <option value="1000">1000</option>
                                        <option value="all">All</option>
                                    </select>
                                </div>

                                <div class="filter-group filter-search">
                                    <label>Search</label>
                                    <input type="text" id="logsSearchInput" placeholder="Filter logs..." oninput="filterLogs()">
                                </div>

                                <div class="filter-group" style="display: flex; align-items: flex-end;">
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 0;">
                                        <input type="checkbox" id="logsTimestamps" onchange="toggleTimestamps()" checked>
                                        <span>Timestamps</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Logs Display -->
                        <div id="logsContainer" class="logs-container">
                            <div class="logs-placeholder">
                                <span data-lucide="file-text" style="width: 48px; height: 48px; opacity: 0.3;"></span>
                                <p>Select one or more containers to view logs</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- About Page -->
                <div id="about-page" class="page-section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <span data-lucide="info"></span> About
                            </h2>
                        </div>
                        <div style="padding: var(--spacing-lg); color: var(--text-secondary);">
                            <p><strong>Docker Monitor v1.1.0</strong></p>
                            <p style="margin-top: var(--spacing-md);">A modern web-based Docker container monitoring solution with real-time alerts and auto-restart capabilities.</p>
                            <p style="margin-top: var(--spacing-md);">Features:</p>
                            <ul style="margin-left: var(--spacing-lg); margin-top: var(--spacing-sm);">
                                <li>Multi-host Docker monitoring</li>
                                <li>Container auto-restart with configurable retries</li>
                                <li>Multi-channel alerting (Telegram, Discord, Pushover)</li>
                                <li>Real-time status updates</li>
                                <li>Modern, responsive interface</li>
                            </ul>
                            <p style="margin-top: var(--spacing-lg);">
                                <strong>Source Code:</strong>
                                <a href="https://github.com/darthnorse/dockmon" target="_blank" style="color: var(--accent-color); text-decoration: none;">
                                    GitHub Repository
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Add Host Modal -->
    <div class="modal" id="hostModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add Docker Host</h2>
                <button class="modal-close" onclick="closeModal('hostModal')">✕</button>
            </div>
            <form onsubmit="addHost(event)">
                <div class="security-alert" id="security-warning" style="display: none;">
                    <span>⚠️</span>
                    <div>
                        <strong>Security Warning:</strong> This connection is not encrypted! Anyone on the network can take control of your Docker host.
                        <a href="https://github.com/darthnorse/dockmon#-security-mtls-configuration-strongly-recommended" target="_blank" style="color: white; text-decoration: underline;">Learn how to set up mTLS</a>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Host Name</label>
                    <input type="text" name="hostname" class="form-input" placeholder="Production Server" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Host URL</label>
                    <input type="text" name="hosturl" class="form-input" placeholder="tcp://192.168.1.100:2376" required
                           onchange="checkHostSecurity(this.value)" oninput="checkHostSecurity(this.value)">
                    <small style="color: var(--text-tertiary);">
                        Examples: <code>unix:///var/run/docker.sock</code> (local), <code>tcp://host:2376</code> (remote with mTLS)
                    </small>
                </div>

                <div class="form-group" id="tls-certificates" style="display: none;">
                    <label class="form-label">TLS Certificates (Required for secure remote connections)</label>

                    <!-- Certificate Input -->
                    <div id="cert-paste-mode" style="display: grid; gap: 10px;">
                        <div>
                            <label style="font-size: 14px; color: var(--text-secondary);">CA Certificate (ca.pem)</label>
                            <textarea name="tlsca-text" class="form-input" placeholder="-----BEGIN CERTIFICATE-----&#10;...paste CA certificate content...&#10;-----END CERTIFICATE-----" rows="4"></textarea>
                        </div>
                        <div>
                            <label style="font-size: 14px; color: var(--text-secondary);">Client Certificate (client-cert.pem)</label>
                            <textarea name="tlscert-text" class="form-input" placeholder="-----BEGIN CERTIFICATE-----&#10;...paste client certificate content...&#10;-----END CERTIFICATE-----" rows="4"></textarea>
                        </div>
                        <div>
                            <label style="font-size: 14px; color: var(--text-secondary);">Client Key (client-key.pem)</label>
                            <textarea name="tlskey-text" class="form-input" placeholder="-----BEGIN PRIVATE KEY-----&#10;...paste client private key content...&#10;-----END PRIVATE KEY-----" rows="4"></textarea>
                        </div>
                    </div>

                    <small style="color: var(--text-tertiary);">
                        Use our <a href="https://github.com/darthnorse/dockmon/blob/main/scripts/setup-docker-mtls.sh" target="_blank">mTLS setup script</a> to generate these certificates.
                    </small>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    Add Host
                </button>
            </form>
        </div>
    </div>

    <!-- Alert Rule Modal -->
    <div class="modal" id="alertRuleModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Create Alert Rule</h2>
                <button class="modal-close" onclick="closeModal('alertRuleModal')">✕</button>
            </div>
            <form onsubmit="createAlertRule(event)">
                <div class="form-group">
                    <label class="form-label">Rule Name</label>
                    <input type="text" class="form-input" id="alertRuleName" placeholder="Enter a name for this alert rule" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Container Selection</label>
                    <div style="margin-bottom: 15px;">
                        <label class="checkbox-item" style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
                            <input type="checkbox" id="selectAllContainers" onchange="toggleAllContainers(this)">
                            <strong>Monitor All Containers (all hosts)</strong>
                        </label>
                    </div>
                    <div id="containerSelectionCheckboxes" style="max-height: 300px; overflow-y: auto; border: 1px solid var(--border); border-radius: 4px; padding: 10px;">
                        <!-- Container checkboxes will be populated here -->
                    </div>
                </div>
                <!-- Docker Events Section -->
                <div class="form-group">
                    <label class="form-label">Docker Events <span style="color: var(--text-tertiary); font-size: 12px; font-weight: normal;">(React to what happens)</span></label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 10px;">
                        <div>
                            <h4 style="color: #dc2626; font-size: 14px; margin-bottom: 10px; font-weight: 500;"><i data-lucide="alert-circle" style="width:14px;height:14px;"></i> Critical</h4>
                            <div class="checkbox-group">
                                <label class="checkbox-item" title="Container was killed due to memory limit exceeded">
                                    <input type="checkbox" data-event="oom"> Out of Memory
                                </label>
                                <label class="checkbox-item" title="Container exited with error code (crashed or failed)">
                                    <input type="checkbox" data-event="die-nonzero"> Die (non-zero exit)
                                </label>
                                <label class="checkbox-item" title="Container health check failed - container may still be running">
                                    <input type="checkbox" data-event="health_status:unhealthy"> Health: Unhealthy
                                </label>
                            </div>
                        </div>
                        <div>
                            <h4 style="color: #d97706; font-size: 14px; margin-bottom: 10px; font-weight: 500;"><i data-lucide="alert-triangle" style="width:14px;height:14px;"></i> Warning</h4>
                            <div class="checkbox-group">
                                <label class="checkbox-item" title="Container was forcefully terminated (SIGKILL)">
                                    <input type="checkbox" data-event="kill"> Killed
                                </label>
                                <label class="checkbox-item" title="Container exited cleanly (exit code 0) but unexpectedly">
                                    <input type="checkbox" data-event="die-zero"> Die (clean exit)
                                </label>
                                <label class="checkbox-item" title="Container restarted multiple times in short period">
                                    <input type="checkbox" data-event="restart-loop"> Restart Loop
                                </label>
                                <label class="checkbox-item" title="Container stuck in 'removing' state for over 2 minutes">
                                    <input type="checkbox" data-event="stuck-removing"> Stuck Removing
                                </label>
                            </div>
                        </div>
                        <div>
                            <h4 style="color: var(--text-secondary); font-size: 14px; margin-bottom: 10px; font-weight: 500;"><i data-lucide="info" style="width:14px;height:14px;"></i> Info</h4>
                            <div class="checkbox-group">
                                <label class="checkbox-item" title="Container was started successfully">
                                    <input type="checkbox" data-event="start"> Started
                                </label>
                                <label class="checkbox-item" title="Container was stopped gracefully (SIGTERM)">
                                    <input type="checkbox" data-event="stop"> Stopped
                                </label>
                                <label class="checkbox-item" title="Container health check passed">
                                    <input type="checkbox" data-event="health_status:healthy"> Health: Healthy
                                </label>
                                <label class="checkbox-item" title="New container was created from image">
                                    <input type="checkbox" data-event="create"> Created
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Docker States Section -->
                <div class="form-group">
                    <label class="form-label">Docker States <span style="color: var(--text-tertiary); font-size: 12px; font-weight: normal;">(React to current status)</span></label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-top: 10px;">
                        <div>
                            <h4 style="color: #ef4444; font-size: 14px; margin-bottom: 10px; font-weight: 500;"><i data-lucide="alert-circle" style="width:14px;height:14px;"></i> Critical</h4>
                            <div class="checkbox-group">
                                <label class="checkbox-item" title="Container has stopped running (exited with any code)">
                                    <input type="checkbox" checked data-state="exited"> Exited
                                </label>
                                <label class="checkbox-item" title="Container has exited and cannot be restarted">
                                    <input type="checkbox" checked data-state="dead"> Dead
                                </label>
                            </div>
                        </div>
                        <div>
                            <h4 style="color: #d97706; font-size: 14px; margin-bottom: 10px; font-weight: 500;"><i data-lucide="alert-triangle" style="width:14px;height:14px;"></i> Warning</h4>
                            <div class="checkbox-group">
                                <label class="checkbox-item" title="Container has been paused and is not running">
                                    <input type="checkbox" data-state="paused"> Paused
                                </label>
                                <label class="checkbox-item" title="Container is being removed (deletion in progress)">
                                    <input type="checkbox" data-state="removing"> Removing
                                </label>
                            </div>
                        </div>
                        <div>
                            <h4 style="color: var(--text-secondary); font-size: 14px; margin-bottom: 10px; font-weight: 500;"><i data-lucide="info" style="width:14px;height:14px;"></i> Info</h4>
                            <div class="checkbox-group">
                                <label class="checkbox-item" title="Container has been created but not started">
                                    <input type="checkbox" data-state="created"> Created
                                </label>
                                <label class="checkbox-item" title="Container is currently running and active">
                                    <input type="checkbox" data-state="running"> Running
                                </label>
                                <label class="checkbox-item" title="Container is in the process of restarting">
                                    <input type="checkbox" data-state="restarting"> Restarting
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Alert Channels</label>
                    <div id="notificationChannelsSection">
                        <p style="color: var(--text-tertiary); font-size: 14px; margin-bottom: 15px;">
                            Configure notification channels first in Settings to enable alerts.
                        </p>
                        <button type="button" class="btn btn-secondary" onclick="openNotificationSettings()">
                            Configure Channels
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Cooldown Period (minutes)</label>
                    <input type="number" class="form-input" id="cooldownMinutes" min="1" max="1440" value="15"
                           placeholder="Minutes between alerts">
                    <small style="color: var(--text-tertiary);">Minimum time between alerts for the same container (default: 15 minutes)</small>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    Create Alert Rule
                </button>
            </form>
        </div>
    </div>

    <!-- Global Settings Modal -->
    <div class="modal" id="globalSettingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Global Settings</h2>
                <button class="modal-close" onclick="closeModal('globalSettingsModal')">✕</button>
            </div>
            <div class="settings-section">
                <h3 style="margin-bottom: var(--spacing-lg); color: var(--text-primary);">Auto-Restart Configuration</h3>
                <div class="settings-row">
                    <div class="settings-label">
                        <div class="settings-title">Maximum Retry Attempts</div>
                        <div class="settings-description">Number of times to attempt restarting a container before giving up</div>
                    </div>
                    <div class="settings-value">
                        <input type="number" class="number-input" id="maxRetries" min="0" max="10">
                        <span style="font-size: 14px; color: var(--text-tertiary);">retries</span>
                    </div>
                </div>
                <div class="settings-row">
                    <div class="settings-label">
                        <div class="settings-title">Retry Delay</div>
                        <div class="settings-description">Time to wait between restart attempts</div>
                    </div>
                    <div class="settings-value">
                        <input type="number" class="number-input" id="retryDelay" min="5" max="300">
                        <span style="font-size: 14px; color: var(--text-tertiary);">seconds</span>
                    </div>
                </div>
                <div class="settings-row">
                    <div class="settings-label">
                        <div class="settings-title">Enable Auto-Restart by Default</div>
                        <div class="settings-description">New containers will have auto-restart enabled automatically</div>
                    </div>
                    <div class="settings-value">
                        <div class="toggle-switch" id="defaultAutoRestart" onclick="toggleSwitch(this)"></div>
                    </div>
                </div>
            </div>
            <div class="settings-section">
                <h3 style="margin-bottom: var(--spacing-lg); color: var(--text-primary);">Monitoring Settings</h3>
                <div class="settings-row">
                    <div class="settings-label">
                        <div class="settings-title">Polling Interval</div>
                        <div class="settings-description">How often to check container states</div>
                    </div>
                    <div class="settings-value">
                        <input type="number" class="number-input" id="pollingInterval" min="5" max="60">
                        <span style="font-size: 14px; color: var(--text-tertiary);">seconds</span>
                    </div>
                </div>
                <div class="settings-row">
                    <div class="settings-label">
                        <div class="settings-title">Connection Timeout</div>
                        <div class="settings-description">Maximum time to wait for host response</div>
                    </div>
                    <div class="settings-value">
                        <input type="number" class="number-input" id="connectionTimeout" min="5" max="30">
                        <span style="font-size: 14px; color: var(--text-tertiary);">seconds</span>
                    </div>
                </div>
            </div>
            <button class="btn btn-primary" style="width: 100%;" onclick="saveGlobalSettings()">
                Save Settings
            </button>
        </div>
    </div>

    <!-- Notification Settings Modal -->
    <div class="modal" id="notificationModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">Notification Settings</h2>
                <button class="modal-close" onclick="closeModal('notificationModal')">✕</button>
            </div>

            <!-- Tab Navigation -->
            <div style="display: flex; gap: var(--spacing-md); margin-bottom: var(--spacing-lg); border-bottom: 1px solid var(--surface-light);">
                <button id="channelsTab" class="tab-btn active" onclick="switchNotificationTab('channels')" style="padding: var(--spacing-md); background: none; border: none; color: var(--primary); border-bottom: 2px solid var(--primary); cursor: pointer;">Channels</button>
                <button id="templateTab" class="tab-btn" onclick="switchNotificationTab('template')" style="padding: var(--spacing-md); background: none; border: none; color: var(--text-secondary); cursor: pointer;">Message Template</button>
                <button id="blackoutTab" class="tab-btn" onclick="switchNotificationTab('blackout')" style="padding: var(--spacing-md); background: none; border: none; color: var(--text-secondary); cursor: pointer;"><span data-lucide="moon"></span> Blackout Windows</button>
            </div>

            <!-- Channels Tab Content -->
            <div id="channelsTabContent">
                <div style="margin-bottom: var(--spacing-lg);">
                    <button type="button" class="btn btn-secondary" onclick="addNotificationChannel()" style="margin-bottom: var(--spacing-md);">
                        <span data-lucide="plus"></span> Add Channel
                    </button>
                </div>
                <div id="notificationChannelsList" style="max-height: 400px; overflow-y: auto;">
                    <!-- Channels will be dynamically inserted here -->
                </div>
                <button type="submit" class="btn btn-primary" onclick="saveAllChannels()" style="width: 100%; margin-top: var(--spacing-lg);">
                    Save All Channels
                </button>
            </div>

            <!-- Template Tab Content -->
            <div id="templateTabContent" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Notification Message Template</label>
                    <textarea id="alertTemplate" class="form-input" rows="10" placeholder="Enter custom template or leave blank for default" style="font-family: 'Courier New', monospace; font-size: 13px;"></textarea>
                    <small style="color: var(--text-secondary); display: block; margin-top: var(--spacing-sm);">
                        Use variables like {CONTAINER_NAME}, {HOST_NAME}, {OLD_STATE}, {NEW_STATE}, etc.
                    </small>
                </div>

                <div style="margin-top: var(--spacing-lg); padding: var(--spacing-md); background: var(--surface); border-radius: var(--radius-md); border: 1px solid var(--surface-light);">
                    <h4 style="margin-bottom: var(--spacing-md); color: var(--text-primary);">Available Variables</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: var(--spacing-sm); font-size: 12px;">
                        <div><code>{CONTAINER_NAME}</code> - Container name</div>
                        <div><code>{CONTAINER_ID}</code> - Container ID (short)</div>
                        <div><code>{HOST_NAME}</code> - Host name</div>
                        <div><code>{HOST_ID}</code> - Host ID</div>
                        <div><code>{OLD_STATE}</code> - Previous state</div>
                        <div><code>{NEW_STATE}</code> - New state</div>
                        <div><code>{IMAGE}</code> - Docker image</div>
                        <div><code>{TIMESTAMP}</code> - Full timestamp</div>
                        <div><code>{TIME}</code> - Time only</div>
                        <div><code>{DATE}</code> - Date only</div>
                        <div><code>{RULE_NAME}</code> - Alert rule name</div>
                        <div><code>{EVENT_TYPE}</code> - Docker event type</div>
                    </div>
                </div>

                <div style="margin-top: var(--spacing-lg);">
                    <h4 style="margin-bottom: var(--spacing-sm); color: var(--text-primary);">Template Examples</h4>
                    <select id="templateExamples" class="form-input" onchange="applyTemplateExample(this.value)" style="margin-bottom: var(--spacing-md);">
                        <option value="">-- Select an example template --</option>
                        <option value="default">Default (Detailed)</option>
                        <option value="simple">Simple</option>
                        <option value="minimal">Minimal</option>
                        <option value="emoji">With Emojis</option>
                    </select>
                </div>

                <button type="button" class="btn btn-primary" onclick="saveNotificationTemplate()" style="width: 100%; margin-top: var(--spacing-lg);">
                    Save Template
                </button>
            </div>

            <!-- Blackout Tab Content -->
            <div id="blackoutTabContent" style="display: none;">
                <div style="margin-bottom: var(--spacing-md); color: var(--text-secondary); font-size: 14px;">
                    Configure blackout windows when alerts should be suppressed. Times are defined in your local timezone. Alerts will be deferred and checked after each window ends.
                </div>

                <div id="blackoutWindowsList" style="margin-bottom: var(--spacing-lg);">
                    <!-- Blackout windows will be rendered here -->
                </div>

                <button type="button" class="btn btn-secondary" onclick="addBlackoutWindow()" style="margin-bottom: var(--spacing-lg);">
                    <span data-lucide="plus"></span> Add Blackout Window
                </button>

                <!-- Current Status -->
                <div id="blackoutStatus" style="padding: var(--spacing-md); background: var(--surface); border-radius: var(--radius-md); border: 1px solid var(--surface-light); margin-bottom: var(--spacing-lg);">
                    <!-- Status will be updated here -->
                </div>

                <!-- Post-Blackout Information -->
                <div id="postBlackoutInfo" style="padding: var(--spacing-md); background: var(--info-bg); border-radius: var(--radius-md); border: 1px solid var(--info-border);">
                    <h4 style="margin-bottom: var(--spacing-sm); color: var(--text-primary);">How Blackout Windows Work</h4>
                    <div style="font-size: 14px; color: var(--text-secondary); line-height: 1.6;">
                        <p style="margin-bottom: var(--spacing-sm);">During a blackout window:</p>
                        <ul style="margin-left: var(--spacing-lg); margin-bottom: var(--spacing-sm);">
                            <li>All alerts are suppressed (not sent)</li>
                            <li>Container events continue to be monitored</li>
                            <li>No notifications will be sent to any channel</li>
                        </ul>
                        <p style="margin-bottom: var(--spacing-sm);">When the blackout window ends:</p>
                        <ul style="margin-left: var(--spacing-lg);">
                            <li>DockMon checks the current state of all containers</li>
                            <li>Alerts are sent for any containers in problematic states</li>
                            <li>This ensures you're notified of issues that occurred during maintenance</li>
                        </ul>
                        <p style="margin-top: var(--spacing-sm); font-style: italic;">
                            💡 Tip: Define alert rules that monitor both events AND states for best coverage.
                        </p>
                    </div>
                </div>

                <button type="button" class="btn btn-primary" onclick="saveBlackoutWindows()" style="width: 100%; margin-top: var(--spacing-lg);">
                    Save Blackout Settings
                </button>
            </div>
        </div>
    </div>

    <!-- Account Settings Modal -->
    <div class="modal" id="accountModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Account Settings</h2>
                <button class="modal-close" onclick="closeModal('accountModal')">&times;</button>
            </div>
            <form onsubmit="saveAccountSettings(event)">
                <div class="form-group">
                    <h3 style="margin-bottom: var(--spacing-md); color: var(--text-primary);">Change Username</h3>
                    <label class="form-label">Current Username</label>
                    <input type="text" id="currentUsername" class="form-input" readonly style="background: var(--surface-light); cursor: not-allowed;">
                    <label class="form-label" style="margin-top: var(--spacing-md);">New Username</label>
                    <input type="text" id="newUsername" class="form-input" placeholder="Enter new username" minlength="3" maxlength="50">
                    <small style="color: var(--text-secondary);">Leave blank to keep current username</small>
                </div>

                <div class="form-group">
                    <h3 style="margin-bottom: var(--spacing-md); color: var(--text-primary);">Change Password</h3>
                    <label class="form-label">Current Password</label>
                    <input type="password" id="currentPassword" class="form-input" placeholder="Enter current password" required>
                    <label class="form-label" style="margin-top: var(--spacing-md);">New Password</label>
                    <input type="password" id="newPassword" class="form-input" placeholder="Enter new password" minlength="8">
                    <label class="form-label" style="margin-top: var(--spacing-md);">Confirm New Password</label>
                    <input type="password" id="confirmPassword" class="form-input" placeholder="Confirm new password">
                    <small style="color: var(--text-secondary);">Password must be at least 8 characters long</small>
                </div>

                <div id="accountError" class="alert alert-danger" style="display: none; margin-bottom: var(--spacing-md);"></div>
                <div id="accountSuccess" class="alert alert-success" style="display: none; margin-bottom: var(--spacing-md);"></div>

                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    Update Account
                </button>
            </form>
        </div>
    </div>

    <!-- Container Details Modal -->
    <div class="modal" id="containerModal">
        <div class="modal-content resizable" style="width: 900px; height: 600px;">
            <div class="modal-header" style="cursor: move;">
                <h2 class="modal-title">Container Details</h2>
                <button class="modal-close" onclick="closeModal('containerModal')">✕</button>
            </div>
            <div class="resize-handle"></div>
            <div id="containerDetails">
                <!-- Container info will be populated here -->
            </div>
            <div style="margin-top: 20px;">
                <ul style="display: flex; gap: 10px; list-style: none; border-bottom: 1px solid var(--border); margin-bottom: 20px;">
                    <li><button class="btn btn-secondary" onclick="showTab('info')" id="tab-info">Info</button></li>
                    <li><button class="btn btn-secondary" onclick="showTab('logs')" id="tab-logs">Logs</button></li>
                </ul>
                
                <!-- Info Tab -->
                <div id="info-tab" class="tab-content">
                    <div id="container-info-content"></div>
                </div>
                
                <!-- Logs Tab -->
                <div id="logs-tab" class="tab-content" style="display: none;">
                    <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center; flex-wrap: wrap;">
                        <button class="btn btn-secondary" onclick="fetchContainerLogs()">Refresh Logs</button>
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="checkbox" id="autoRefreshLogs" checked onchange="toggleAutoRefresh()" style="cursor: pointer;">
                            <span>Auto-refresh</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="checkbox" id="showTimestamps" onchange="updateLogDisplay()" style="cursor: pointer;">
                            <span>Show timestamps</span>
                        </label>
                        <span style="color: var(--text-secondary);">Lines:</span>
                        <input type="number" id="logTailCount" value="100" min="1" max="1000" style="width: 80px; padding: 8px;" placeholder="Lines">
                        <div style="flex: 1; min-width: 200px; position: relative;">
                            <input type="text" id="logSearchFilter" placeholder="Filter logs..." oninput="updateLogDisplay()"
                                style="width: 100%; padding: 8px 30px 8px 10px; border: 1px solid var(--border); border-radius: 6px; background: var(--surface); color: var(--text-primary);">
                            <span id="logMatchCount" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); font-size: 12px;"></span>
                        </div>
                        <button class="btn btn-secondary" onclick="clearLogFilter()" title="Clear filter" style="padding: 8px 12px;">&times;</button>
                    </div>
                    <div id="container-logs" style="background: var(--dark); padding: 15px; border-radius: 6px; height: 350px; overflow-y: auto; font-family: 'Monaco', 'Courier New', monospace; font-size: 10px; line-height: 1.4; white-space: pre-wrap; word-break: break-all; resize: vertical; min-height: 200px; max-height: 600px;" onmouseup="saveModalPreferences()">
                        <div style="color: var(--text-tertiary);">Loading logs...</div>
                    </div>
                </div>
                
                <!-- Exec functionality removed for security reasons -->
            </div>
        </div>
    </div>

    <!-- Confirmation Dialog Modal -->
    <div class="modal" id="confirmationModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title" id="confirmationTitle">Confirm Action</h2>
                <button class="modal-close" onclick="closeConfirmation()">✕</button>
            </div>
            <div class="modal-body" style="padding: 20px 0;">
                <p id="confirmationMessage" style="margin-bottom: 20px; line-height: 1.5;"></p>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button class="btn btn-secondary" onclick="closeConfirmation()">Cancel</button>
                    <button class="btn" id="confirmationButton" style="background: var(--danger); border-color: var(--danger);" onclick="confirmAction()">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Mobile Bottom Navigation -->
    <div class="mobile-bottom-nav">
        <div class="mobile-nav-item active" data-page="dashboard">
            <i class="mobile-nav-icon" data-lucide="layout-grid"></i>
            <span class="mobile-nav-label">Dashboard</span>
        </div>
        <div class="mobile-nav-item" data-page="hosts">
            <i class="mobile-nav-icon" data-lucide="server"></i>
            <span class="mobile-nav-label">Hosts</span>
        </div>
        <div class="mobile-nav-item" data-page="alerts">
            <i class="mobile-nav-icon" data-lucide="alert-triangle"></i>
            <span class="mobile-nav-label">Alerts</span>
        </div>
        <div class="mobile-nav-item" data-page="events">
            <i class="mobile-nav-icon" data-lucide="activity"></i>
            <span class="mobile-nav-label">Events</span>
        </div>
        <div class="mobile-nav-item" data-page="more">
            <i class="mobile-nav-icon" data-lucide="more-horizontal"></i>
            <span class="mobile-nav-label">More</span>
            <div class="more-menu">
                <div class="more-menu-item" onclick="openAccountSettings(); document.querySelector('.more-menu').classList.remove('show');">
                    <i data-lucide="user"></i>
                    <span>Account</span>
                </div>
                <!-- Logs viewer will be added later, for now this goes to Events -->
                <!-- <div class="more-menu-item" onclick="switchPage('logs'); document.querySelector('.more-menu').classList.remove('show');">
                    <i data-lucide="file-text"></i>
                    <span>Logs</span>
                </div> -->
                <div class="more-menu-item" onclick="switchPage('about'); document.querySelector('.more-menu').classList.remove('show');">
                    <i data-lucide="info"></i>
                    <span>About</span>
                </div>
                <div class="more-menu-item" onclick="logout(); document.querySelector('.more-menu').classList.remove('show');">
                    <i data-lucide="log-out"></i>
                    <span>Logout</span>
                </div>
            </div>
        </div>
    </div>

    <!-- GridStack.js Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/gridstack@12.3.3/dist/gridstack-all.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.umd.min.js"></script>
    <!-- DockMon Core JavaScript -->
    <script src="/js/core.js"></script>
    <!-- Metrics JavaScript -->
    <script src="/js/metrics.js"></script>
    <!-- Notifications JavaScript (loaded before app.js since app.js depends on it) -->
    <script src="/js/notifications.js"></script>
    <!-- Dashboard JavaScript (loaded before app.js since app.js depends on it) -->
    <script src="/js/dashboard.js"></script>
    <!-- Alerts JavaScript (loaded before app.js since app.js depends on it) -->
    <script src="/js/alerts.js"></script>
    <!-- DockMon Application JavaScript -->
    <script src="/js/app.js"></script>
    <!-- Event Log JavaScript -->
    <script src="/js/events.js"></script>
    <script src="/js/logs.js"></script>
</body>
</html>
