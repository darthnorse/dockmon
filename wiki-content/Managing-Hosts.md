# Managing Hosts

Learn how to add, configure, and manage Docker hosts in DockMon.

## Overview

DockMon can monitor containers across **unlimited Docker hosts**, both local and remote. Each host appears in the dashboard with its own containers, allowing you to manage your entire Docker infrastructure from one place.

---

## Host Types

### Local Docker Host

**What it is:** The Docker instance running on the same machine as DockMon.

**Connection:** Unix socket (`unix:///var/run/docker.sock`)

**Setup:** **Automatic** - DockMon configures this on first run, no manual setup needed!

**Security:** Secure - socket access is local only

### Remote Docker Host

**What it is:** Docker running on another server/machine.

**Connection:** TCP with mTLS (`tcp://[ip]:2376`)

**Setup:** Manual configuration required - see [Remote Docker Setup](Remote-Docker-Setup)

**Security:** ⚠️ **Requires mTLS certificates** - never use insecure TCP in production!

---

## Adding a Host

### Method 1: Via Hosts Page

1. Navigate to **Hosts** in the sidebar
2. Click **"Add Host"** button
3. Fill in the host details (see below)
4. Click **"Save"**
5. DockMon will test the connection automatically
6. If successful, the host appears in the table
7. If failed, an error message will show what went wrong

### Method 2: During First Run

**Local Docker** is automatically added when you first start DockMon. No action needed!

---

## Host Configuration Fields

### Name
**Required:** Yes
**Example:** `Production Server`, `NAS Docker`, `Dev Machine`

**Description:** A friendly name to identify this host in the dashboard.

**Best practices:**
- Use descriptive names (not "Docker 1", "Docker 2")
- Include environment (Production, Staging, Dev)
- Include location if managing multiple sites

### URL
**Required:** Yes
**Format:**
- Local: `unix:///var/run/docker.sock`
- Remote (secure): `tcp://192.168.1.100:2376`
- Remote (insecure): `tcp://192.168.1.100:2375` (⚠️ **NOT recommended**)

**Examples:**
```
unix:///var/run/docker.sock        # Local Docker
tcp://192.168.1.43:2376           # Remote with TLS
tcp://production.example.com:2376  # Remote with hostname
```

**Important:**
- Port **2376** = TLS (secure)
- Port **2375** = No TLS (insecure) ⚠️
- Always use port 2376 for remote hosts in production

### TLS Certificates (For Remote Hosts Only)

When connecting to remote Docker hosts securely, you need three certificates:

#### CA Certificate
**Required for TLS:** Yes
**What it is:** Certificate Authority that signed the server and client certificates
**How to get:** Generated by mTLS setup script
**Format:** PEM format, starts with `-----BEGIN CERTIFICATE-----`

#### Client Certificate
**Required for TLS:** Yes
**What it is:** Certificate that identifies DockMon to the remote Docker daemon
**How to get:** Generated by mTLS setup script (`client-cert.pem`)
**Format:** PEM format, starts with `-----BEGIN CERTIFICATE-----`

#### Client Key
**Required for TLS:** Yes
**What it is:** Private key for the client certificate
**How to get:** Generated by mTLS setup script (`client-key.pem`)
**Format:** PEM format, starts with `-----BEGIN RSA PRIVATE KEY-----` or `-----BEGIN PRIVATE KEY-----`
**⚠️ Important:** Keep this secret! Never commit to git or share publicly.

**How to paste certificates:**

1. On the remote host, display the certificate:
   ```bash
   cat ~/.docker/certs/ca.pem
   cat ~/.docker/certs/client-cert.pem
   cat ~/.docker/certs/client-key.pem
   ```

2. Copy the **entire output** including the `-----BEGIN-----` and `-----END-----` lines

3. Paste into the respective field in DockMon

See [Remote Docker Setup](Remote-Docker-Setup) for detailed certificate generation instructions.

---

## Connection Verification

When you save a host, DockMon automatically tests the connection.

### Possible Results

**Success**
- Host appears in the host list
- Shows "Online" status with green indicator
- Containers immediately visible in dashboard

**Error: "Connection refused"**
- Docker daemon is not listening on that port
- Firewall blocking the connection
- Wrong IP address or port
- See [Troubleshooting](Troubleshooting#connection-refused-to-remote-host)

**Error: "Certificate verification failed"**
- Certificates don't match
- Wrong CA, client cert, or client key
- Certificates expired
- See [Troubleshooting](Troubleshooting#certificate-verification-failed)

**Error: "Timeout"**
- Host is unreachable
- Network issues
- Docker daemon is slow to respond

If the connection fails, the host is **not added** and you'll see an error message explaining what went wrong.

---

## Editing a Host

### Update Host Details

1. Navigate to **Hosts** in the sidebar
2. Find the host in the table
3. Click the **Edit** icon in the Actions column
4. Modify any fields
5. Click **"Save"**
6. DockMon will test the new connection automatically

**Note:** Editing a host **does NOT** affect its containers. Container data and auto-restart settings are preserved.

### Common Edits

**Change host IP/hostname:**
- Update the URL field
- Save (connection is tested automatically)

**Update certificates:**
- Paste new CA, client cert, or client key
- Save (connection is tested automatically)

**Rename host:**
- Update the name field
- Save

---

## Removing a Host

### Delete a Host

1. Navigate to **Hosts** in the sidebar
2. Find the host in the table
3. Click the **Delete** icon in the Actions column
4. Confirm deletion

**⚠️ Warning:** This will:
- Remove the host from DockMon
- Stop monitoring its containers
- **Delete alert rules** specific to that host's containers
- **NOT** affect the actual Docker host (it continues running normally)

**What happens to containers:**
- Container data is removed from DockMon
- Containers continue running on the host
- Auto-restart configurations are lost
- You can re-add the host later (starts fresh)

---

## Viewing Host Details

### Opening Host Details

**Default behavior** (Simplified Workflow enabled):
- Click on a host card in the Dashboard to open the full host details modal

**Alternative behavior** (Simplified Workflow disabled):
- Click on a host card to open the drawer (side panel)
- The drawer provides quick access to host information

**Toggle workflow**: Settings → Dashboard → Simplified Workflow

### Host Details Modal

The host details modal provides comprehensive information about a specific host.

#### KPI Cards (Header)

At the top of the modal, four KPI cards show:
- **Total Containers** - Total number of containers on this host
- **Running** (green) - Number of running containers
- **Stopped** - Number of stopped/exited containers
- **Alerts** - Number of active alerts for this host

#### Overview Tab

**Left Column:**

**Host Information**
- **Address**: Docker connection URL (unix socket or TCP address)
- **OS**: Operating system version
- **Docker Version**: Docker daemon version
- **CPU**: Number of CPU cores
- **Memory**: Total system memory

**Tags**
- View all tags assigned to this host
- Click "+ Edit" to add/remove tags
- Tags help organize hosts and can be used for filtering and alert targeting

**Recent Events**
- Last 3 events for this host
- Shows timestamp, severity, and event title
- Click the Events tab for full event history

**Right Column:**

**Live Stats** - Real-time performance metrics with sparkline charts:
- **CPU Usage**: Current CPU percentage with historical chart
- **Memory Usage**: Current memory usage with historical chart
- **Network Traffic**: Current network throughput (bytes/sec) with historical chart

All charts update in real-time via WebSocket connection.

#### Containers Tab

Displays the full container table filtered to show only containers running on this host.

**Features:**
- All standard container table functionality
- Start/stop/restart individual containers
- View container details
- Bulk select and perform batch operations
- Sort and filter containers
- View container stats, logs, and events

See [Container Operations](Container-Operations) for detailed container management.

#### Events Tab

Comprehensive event history for this host with advanced filtering and export.

**Filtering Options:**
- **Time Range**: Last 1 hour, 6 hours, 12 hours, 24 hours, 48 hours, 7 days, 30 days, or All time
- **Severity**: Filter by critical, error, warning, or info
- **Category**: Filter by container, host, system, network, or volume events
- **Container**: Search and select specific containers to view their events
- **Search**: Free-text search across event title, message, and container name

**Actions:**
- **Export CSV**: Download filtered events as CSV file
- **Sort Order**: Toggle between newest first (default) and oldest first
- **Reset**: Clear all filters and return to defaults

**Event Display:**
- Shows timestamp, severity (color-coded), and event details
- Expandable rows with full event information
- Event count footer shows total matching events

See [Event Viewer](Event-Viewer) for more on working with events.

---

## Host Status Indicators

Hosts show their current status in the dashboard:

### Online
- Successfully connected to Docker daemon
- Monitoring active
- Containers visible

### Offline
- Cannot connect to Docker daemon
- Host may be down, or network issues
- Containers not visible until reconnected

### Error
- Connection issues
- Authentication failures
- Certificate problems

**Hover over the status** to see detailed error messages.

---

## Host Security Status

DockMon indicates the security level of each host connection:

### Secure
- Local Docker (Unix socket)
- Remote Docker with mTLS (port 2376 with certificates)

### ⚠️ Insecure
- Remote Docker without TLS (port 2375)
- **Not recommended for production!**

**Best practice:** All remote hosts should show "Secure" status.

---

## Managing Multiple Hosts

### Best Practices

**Naming convention:**
```
Production-WebServer
Production-Database
Staging-WebServer
Dev-LocalDocker
HomeNAS-Docker
```

**Organize by:**
- Environment (Production, Staging, Dev)
- Location (Site1, Site2, Remote, Local)
- Purpose (Web, Database, Storage)

**Certificate management:**
- Use separate certificates for each host
- Rotate certificates every 90-365 days
- Keep certificates backed up securely

**Monitoring strategy:**
- Critical hosts: Enable auto-restart and alerts
- Development hosts: Monitor only, no auto-restart
- Use [Alert Rules](Alert-Rules) to target specific hosts

---

## Auto-Configuration Features

### First Run Auto-Setup

When DockMon starts for the first time:
1. Detects local Docker socket
2. Automatically adds "Local Docker" host
3. Begins monitoring immediately
4. No manual configuration needed!

**What if local Docker wasn't auto-added?**

This is rare, but you can add it manually:
1. Click "Add Host"
2. Name: `Local Docker`
3. URL: `unix:///var/run/docker.sock`
4. Leave certificates empty
5. Save

---

## Host Limits

**Maximum hosts:** Unlimited - no hard limit

**Performance:**
- DockMon uses async I/O for efficient multi-host monitoring
- Each host is checked independently in the monitoring loop
- Tested with 10+ hosts without performance issues
- Performance depends on:
  - Polling interval (default: 10 seconds)
  - Number of containers per host
  - Network latency to remote hosts
  - Available system resources (CPU, RAM)

**Scaling recommendations:**
- Typical deployment: 10-50 hosts works well
- If monitoring 100+ hosts, consider:
  - Increasing polling interval (30-60 seconds)
  - Allocating more RAM to DockMon container
  - Using faster storage for database
  - Monitoring DockMon resource usage

---

## Troubleshooting

### Host Shows Offline But Docker Is Running

**Possible causes:**
1. Network connectivity issues
2. Firewall blocking port 2376
3. Docker daemon not listening on TCP
4. Certificates expired or invalid

**Solutions:**
1. Test connectivity: `telnet [host-ip] 2376`
2. Check Docker logs on remote host: `journalctl -u docker`
3. Verify Docker is listening: `ss -tlnp | grep 2376`
4. Regenerate certificates if needed

### Can't Add Local Docker

**Error:** "Permission denied" or "Cannot connect to Docker socket"

**Solutions:**
1. Verify Docker socket is mounted:
   ```bash
   docker inspect dockmon | grep docker.sock
   ```

2. Check socket permissions:
   ```bash
   ls -l /var/run/docker.sock
   ```

3. Restart DockMon:
   ```bash
   docker compose restart
   ```

### Host Keeps Disconnecting

**Possible causes:**
1. Network instability
2. Docker daemon restarting frequently
3. Firewall rules changing
4. Certificate issues

**Solutions:**
1. Check network stability: `ping [host-ip]`
2. Check Docker daemon logs for crashes
3. Verify firewall rules are persistent
4. Check certificate expiration dates

For more troubleshooting, see [Troubleshooting](Troubleshooting).

---

## Next Steps

- [Remote Docker Setup](Remote-Docker-Setup) - Configure remote hosts with mTLS
- [Container Operations](Container-Operations) - Manage containers on your hosts
- [Alert Rules](Alert-Rules) - Set up alerts for specific hosts
- [Security Guide](Security-Guide) - Best practices for host security